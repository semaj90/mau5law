// @ts-nocheck
import { db } from './index.js';
import { 
  users, 
  cases, 
  evidence, 
  userAiQueries, 
  autoTags,
  documentChunks,
  embeddingCache
} from './schema.js';
import { hash } from '@node-rs/argon2';
import { generateIdFromEntropySize } from 'lucia';

// Sample embeddings (normally these would be generated by AI model)
const sampleEmbeddings = {
  financial: Array.from({ length: 768 }, () => Math.random() * 0.1 + 0.1),
  legal: Array.from({ length: 768 }, () => Math.random() * 0.1 + 0.2),
  criminal: Array.from({ length: 768 }, () => Math.random() * 0.1 + 0.3),
};

async function seed() {
  console.log('üå± Starting database seed...');

  try {
    // Create test users
    console.log('üë§ Creating users...');
    const passwordHash = await hash('password123', {
      memoryCost: 19456,
      timeCost: 2,
      outputLen: 32,
      parallelism: 1,
    });

    const seedUsers = [
      {
        id: generateIdFromEntropySize(10),
        email: 'prosecutor@legal.ai',
        name: 'John Prosecutor',
        firstName: 'John',
        lastName: 'Prosecutor',
        role: 'prosecutor',
        hashedPassword: passwordHash,
      },
      {
        id: generateIdFromEntropySize(10),
        email: 'detective@legal.ai',
        name: 'Jane Detective',
        firstName: 'Jane', 
        lastName: 'Detective',
        role: 'detective',
        hashedPassword: passwordHash,
      },
      {
        id: generateIdFromEntropySize(10),
        email: 'admin@legal.ai',
        name: 'Admin User',
        firstName: 'Admin',
        lastName: 'User', 
        role: 'admin',
        hashedPassword: passwordHash,
      }
    ];

    const insertedUsers = await db.insert(users).values(seedUsers).returning();
    console.log(`‚úÖ Created ${insertedUsers.length} users`);

    // Create test cases
    console.log('üìÅ Creating cases...');
    const seedCases = [
      {
        id: generateIdFromEntropySize(10),
        caseNumber: 'CASE-2024-001',
        title: 'Financial Fraud Investigation',
        description: 'Complex financial fraud case involving multiple entities and cryptocurrency transactions. Suspected money laundering through shell companies with international wire transfers exceeding $2.3M.',
        priority: 'high',
        status: 'open',
        category: 'financial_fraud',
        dangerScore: 75,
        createdBy: insertedUsers[0].id,
        aiSummary: 'High-priority financial fraud case with strong evidence of money laundering. Key suspects identified through transaction pattern analysis. Recommend coordinating with international law enforcement.',
        aiTags: ['money_laundering', 'cryptocurrency', 'international', 'high_value'],
      },
      {
        id: generateIdFromEntropySize(10),
        caseNumber: 'CASE-2024-002', 
        title: 'Cybercrime Investigation',
        description: 'Data breach and identity theft case with international connections. Over 100,000 personal records compromised including SSNs, credit card numbers, and personal identifying information.',
        priority: 'medium',
        status: 'open',
        category: 'cybercrime',
        dangerScore: 60,
        createdBy: insertedUsers[1].id,
        aiSummary: 'Large-scale data breach affecting consumers across multiple states. Evidence suggests sophisticated APT group involvement. Identity theft reports continuing to increase.',
        aiTags: ['data_breach', 'identity_theft', 'apt_group', 'consumer_harm'],
      },
      {
        id: generateIdFromEntropySize(10),
        caseNumber: 'CASE-2024-003',
        title: 'White Collar Crime',
        description: 'Corporate embezzlement case with extensive document evidence. CFO suspected of diverting company funds to personal accounts over 3-year period.',
        priority: 'high', 
        status: 'open',
        category: 'embezzlement',
        dangerScore: 45,
        createdBy: insertedUsers[0].id,
        aiSummary: 'Clear evidence of systematic embezzlement through fraudulent invoicing and payment redirection. Total loss estimated at $1.8M. Strong documentary evidence available.',
        aiTags: ['embezzlement', 'white_collar', 'corporate_fraud', 'systematic'],
      }
    ];

    const insertedCases = await db.insert(cases).values(seedCases).returning();
    console.log(`‚úÖ Created ${insertedCases.length} cases`);

    // Create test evidence
    console.log('üîç Creating evidence...');
    const seedEvidence = [
      {
        id: generateIdFromEntropySize(10),
        caseId: insertedCases[0].id,
        title: 'Bank Transaction Records',
        description: 'Suspicious transaction patterns showing money laundering activity. Records span 18 months and include wire transfers to offshore accounts.',
        evidenceType: 'financial_document',
        tags: ['transactions', 'banking', 'offshore'],
        uploadedBy: insertedUsers[0].id,
        aiAnalysis: {
          confidence: 0.92,
          patterns: ['structuring', 'round_amounts', 'threshold_avoidance'],
          recommendations: ['Focus on accounts 4457 and 8821', 'Check international wire transfer compliance'],
        },
        aiTags: ['money_laundering', 'suspicious_patterns', 'high_confidence'],
        aiSummary: 'Strong evidence of money laundering through structured transactions. 15 suspicious transactions identified totaling $2.3M.',
      },
      {
        id: generateIdFromEntropySize(10),
        caseId: insertedCases[0].id,
        title: 'Email Communications',
        description: 'Email chain between suspects discussing fraudulent activities. Contains explicit references to money movement and account setup.',
        evidenceType: 'digital_evidence',
        tags: ['email', 'communications', 'conspiracy'],
        uploadedBy: insertedUsers[1].id,
        aiAnalysis: {
          confidence: 0.89,
          entities: ['John Smith', 'Cayman Islands Bank', 'Shell Corp LLC'],
          keywords: ['layering', 'clean funds', 'placement'],
        },
        aiTags: ['communications', 'conspiracy_evidence', 'high_value'],
        aiSummary: 'Email communications provide direct evidence of criminal conspiracy and money laundering scheme planning.',
      },
      {
        id: generateIdFromEntropySize(10),
        caseId: insertedCases[1].id,
        title: 'Server Logs',
        description: 'Access logs showing unauthorized data access and exfiltration. Evidence of SQL injection attacks and privilege escalation.',
        evidenceType: 'digital_evidence',
        tags: ['logs', 'unauthorized_access', 'data_exfiltration'],
        uploadedBy: insertedUsers[1].id,
        aiAnalysis: {
          confidence: 0.94,
          techniques: ['sql_injection', 'privilege_escalation', 'data_exfiltration'],
          timeline: '2024-01-15 to 2024-03-20',
        },
        aiTags: ['cyberattack', 'technical_evidence', 'timeline_established'],
        aiSummary: 'Server logs provide clear technical evidence of unauthorized access and systematic data exfiltration over 2-month period.',
      },
      {
        id: generateIdFromEntropySize(10),
        caseId: insertedCases[2].id,
        title: 'Financial Statements',
        description: 'Falsified company financial statements with discrepancies. Comparison between internal and external reporting shows significant variance.',
        evidenceType: 'financial_document',
        tags: ['financial_statements', 'falsification', 'variance_analysis'],
        uploadedBy: insertedUsers[0].id,
        aiAnalysis: {
          confidence: 0.87,
          discrepancies: ['revenue_inflation', 'expense_understatement', 'asset_overvaluation'],
          amount: '$1.8M total variance',
        },
        aiTags: ['document_fraud', 'financial_manipulation', 'systematic_falsification'],
        aiSummary: 'Financial statements show systematic manipulation to hide embezzlement. Clear pattern of revenue inflation and expense manipulation.',
      }
    ];

    const insertedEvidence = await db.insert(evidence).values(seedEvidence).returning();
    console.log(`‚úÖ Created ${insertedEvidence.length} evidence items`);

    console.log('\nüéâ Database seed completed successfully!');
    console.log(`
üìä Summary:
   üë§ Users: ${insertedUsers.length}
   üìÅ Cases: ${insertedCases.length} 
   üîç Evidence: ${insertedEvidence.length}

üîê Test Login Credentials:
   prosecutor@legal.ai / password123
   detective@legal.ai / password123
   admin@legal.ai / password123
`);

  } catch (error) {
    console.error('‚ùå Seed failed:', error);
    throw error;
  }
}

if (import.meta.url === `file://${process.argv[1]}`) {
  seed();
}

export { seed };